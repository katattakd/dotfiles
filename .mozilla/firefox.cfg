// This borrows a LOT from ghacks-user.js (commit bb1e5bfd54c5281f372e596712b91c8444c1c785)
// https://github.com/ghacksuserjs/ghacks-user.js/blob/master/user.js

// Get rid of some annoyances
lockPref("general.warnOnAboutConfig", false);
lockPref("browser.aboutConfig.showWarning", false);
lockPref("browser.shell.checkDefaultBrowser", false);
lockPref("browser.fixup.alternate.enabled", false);
lockPref("browser.urlbar.trimURLs", false);
lockPref("browser.urlbar.usepreloadedtopurls.enabled", false);
lockPref("browser.sessionstore.interval", 240000);
lockPref("media.autoplay.default", 5);
lockPref("browser.link.open_newwindow", 3);
lockPref("browser.link.open_newwindow.restriction", 0);
lockPref("dom.disable_open_during_load", true);
lockPref("dom.popup_allowed_events", "click dblclick");
lockPref("dom.serviceWorkers.enabled", false);
lockPref("dom.webnotifications.enabled", false);
lockPref("dom.webnotifications.serviceworker.enabled", false);
lockPref("dom.disable_beforeunload", true);
lockPref("browser.helperApps.deleteTempFileOnExit", true);
lockPref("browser.pagethumbnails.capturing_disabled", true);
lockPref("middlemouse.contentLoadURL", false);
lockPref("permissions.default.shortcuts", 2);
lockPref("pdfjs.disabled", false);
lockPref("browser.startup.homepage_override.mstone", "ignore");
lockPref("browser.tabs.warnOnClose", false);
lockPref("browser.tabs.warnOnCloseOtherTabs", false);
lockPref("browser.tabs.warnOnOpen", false);
lockPref("full-screen-api.warning.delay", 0);
lockPref("full-screen-api.warning.timeout", 0);
lockPref("browser.download.autohideButton", true);
lockPref("toolkit.cosmeticAnimations.enabled", false);
lockPref("ui.key.menuAccessKey", 0);
lockPref("browser.messaging-system.whatsNewPanel.enabled", false);
lockPref("browser.bookmarks.max_backups", 2);
lockPref("browser.newtabpage.activity-stream.feeds.topsites", false);
lockPref("browser.newtabpage.activity-stream.feeds.section.highlights", false);
lockPref("xpinstall.signatures.required", false);

// Disable telemetry
lockPref("browser.newtabpage.activity-stream.feeds.telemetry", false);
lockPref("browser.newtabpage.activity-stream.telemetry", false);
lockPref("browser.newtabpage.activity-stream.feeds.snippets", false);
lockPref("browser.newtabpage.activity-stream.asrouter.providers.snippets", "");
lockPref("browser.newtabpage.activity-stream.feeds.section.topstories", false);
lockPref("browser.newtabpage.activity-stream.section.highlights.includePocket", false);
lockPref("browser.newtabpage.activity-stream.showSponsored", false);
lockPref("browser.newtabpage.activity-stream.feeds.discoverystreamfeed", false);
lockPref("geo.provider.network.url", "https://location.services.mozilla.com/v1/geolocate?key=%MOZILLA_API_KEY%");
lockPref("browser.search.geoSpecificDefaults", false);
lockPref("browser.search.geoSpecificDefaults.url", "");
lockPref("dom.ipc.plugins.flash.subprocess.crashreporter.enabled", false);
lockPref("dom.ipc.plugins.reportCrashURL", false);
lockPref("extensions.getAddons.showPane", false);
lockPref("extensions.htmlaboutaddons.recommendations.enabled", false);
lockPref("toolkit.telemetry.unified", false);
lockPref("toolkit.telemetry.enabled", false);
lockPref("toolkit.telemetry.server", "data:,");
lockPref("toolkit.telemetry.archive.enabled", false);
lockPref("toolkit.telemetry.newProfilePing.enabled", false);
lockPref("toolkit.telemetry.shutdownPingSender.enabled", false);
lockPref("toolkit.telemetry.updatePing.enabled", false);
lockPref("toolkit.telemetry.bhrPing.enabled", false);
lockPref("toolkit.telemetry.firstShutdownPing.enabled", false);
lockPref("toolkit.telemetry.coverage.opt-out", true);
lockPref("toolkit.coverage.opt-out", true);
lockPref("toolkit.coverage.endpoint.base", "");
lockPref("datareporting.healthreport.uploadEnabled", false);
lockPref("datareporting.policy.dataSubmissionEnabled", false);
lockPref("app.shield.optoutstudies.enabled", false);
lockPref("browser.discovery.enabled", false);
lockPref("breakpad.reportURL", "");
lockPref("browser.tabs.crashReporting.sendReport", false);
lockPref("browser.crashReports.unsubmittedCheck.enabled", false);
lockPref("browser.crashReports.unsubmittedCheck.autoSubmit2", false);
lockPref("captivedetect.canonicalURL", "");
lockPref("network.captive-portal-service.enabled", false);
lockPref("network.connectivity-service.enabled", false);
lockPref("browser.safebrowsing.malware.enabled", false);
lockPref("browser.safebrowsing.phishing.enabled", false);
lockPref("browser.safebrowsing.downloads.enabled", false);
lockPref("app.normandy.enabled", false);
lockPref("app.normandy.api_url", "");
lockPref("extensions.systemAddon.update.enabled", false);
lockPref("extensions.systemAddon.update.url", "");
lockPref("browser.ping-centre.telemetry", false);
lockPref("extensions.screenshots.upload-disabled", true);
lockPref("extensions.webcompat-reporter.enabled", false);
lockPref("security.ssl.errorReporting.automatic", false);
lockPref("security.ssl.errorReporting.enabled", false);
lockPref("security.ssl.errorReporting.url", "");
lockPref("dom.push.enabled", false);
lockPref("dom.push.userAgentID", "");
lockPref("extensions.webextensions.restrictedDomains", "");
lockPref("extensions.pocket.enabled", false);
lockPref("identity.fxaccounts.enabled", false);
lockPref("browser.newtabpage.activity-stream.asrouter.userprefs.cfr.addons", false);
lockPref("browser.newtabpage.activity-stream.asrouter.userprefs.cfr.features", false);
lockPref("network.manage-offline-status", false);

// Various privacy improvements
lockPref("browser.privatebrowsing.autostart", true);
lockPref("extensions.formautofill.addresses.enabled", false);
lockPref("extensions.formautofill.available", "off");
lockPref("extensions.formautofill.creditCards.enabled", false);
lockPref("extensions.formautofill.heuristics.enabled", false);
lockPref("browser.send_pings", false);
lockPref("browser.send_pings.require_same_host", true);
lockPref("network.proxy.socks_remote_dns", true);
lockPref("layout.css.visited_links_enabled", false);
lockPref("signon.rememberSignons", false);
lockPref("signon.autofillForms", false);
lockPref("network.auth.subresource-http-auth-allow", 1);
lockPref("permissions.memory_only", true);
lockPref("browser.privatebrowsing.forceMediaMemoryCache", false);
lockPref("media.memory_cache_max_size", 16384);
lockPref("gfx.font_rendering.graphite.enabled", false);
lockPref("network.http.sendRefererHeader", 1);
lockPref("network.http.referer.XOriginPolicy", 1); // Can break some login pages
lockPref("network.http.referer.hideOnionSource", true);
lockPref("privacy.donottrackheader.enabled", true);
lockPref("plugin.state.flash", 0);
lockPref("media.gmp-provider.enabled", false);
lockPref("media.gmp-widevinecdm.visible", false); // Disables DRM
lockPref("media.gmp-widevinecdm.enabled", false); // Disables DRM
lockPref("media.eme.enabled", false);             // Disables DRM
lockPref("media.peerconnection.ice.default_address_only", true);
lockPref("media.peerconnection.ice.no_host", true);
lockPref("media.peerconnection.ice.proxy_only_if_behind_proxy", true);
lockPref("webgl.min_capability_mode", true);
lockPref("webgl.disable-fail-if-major-performance-caveat", true);
lockPref("dom.event.clipboardevents.enabled", false); // Can break copy/paste on some online text editors
lockPref("accessibility.force_disabled", 1)
lockPref("beacon.enabled", false);
lockPref("devtools.debugger.remote-enabled", false);
lockPref("permissions.manager.defaultsUrl", "");
lockPref("webchannel.allowObject.urlWhitelist", "");
lockPref("network.IDN_show_punycode", true);
lockPref("browser.display.use_system_colors", false);
lockPref("permissions.delegation.enabled", false);
lockPref("network.cookie.thirdparty.nonsecureSessionOnly", true);
lockPref("privacy.firstparty.isolate", true); // Can break some login pages
lockPref("privacy.resistFingerprinting", true);
lockPref("privacy.resistFingerprinting.block_mozAddonManager", true);
//lockPref("privacy.resistFingerprinting.letterboxing", true); // Looks ugly af

// Privacy improvements that impact performance
lockPref("network.prefetch-next", false);
lockPref("network.dns.disablePrefetch", true);
lockPref("network.dns.disablePrefetchFromHTTPS", true);
lockPref("network.predictor.enabled", false);
lockPref("network.predictor.enable-prefetch", false);
lockPref("network.http.speculative-parallel-limit", 0);
lockPref("browser.urlbar.speculativeConnect.enabled", false);
lockPref("browser.cache.disk.enable", false);
//lockPref("media.peerconnection.enabled", false);
//lockPref("webgl.disabled", true);
//lockPref("webgl.enable-webgl2", false);
//lockPref("javascript.options.asmjs", false);
//lockPref("javascript.options.ion", false);
//lockPref("javascript.options.baselinejit", false);
//lockPref("javascript.options.jit_trustedprincipals", true);
//lockPref("javascript.options.wasm", false);
//lockPref("layers.acceleration.disabled", true);
lockPref("browser.cache.offline.enable", false);

// TLS hardening
lockPref("security.ssl.require_safe_negotiation", true);
lockPref("security.tls.version.enable-deprecated", false);
lockPref("security.ssl.disable_session_identifiers", true);
lockPref("security.tls.enable_0rtt_data", false);
lockPref("security.ssl.enable_ocsp_stapling", true);
lockPref("security.OCSP.enabled", 1);
lockPref("security.OCSP.require", true);
lockPref("security.pki.sha1_enforcement_level", 1);
lockPref("security.cert_pinning.enforcement_level", 2);
lockPref("security.mixed_content.block_active_content", true);
lockPref("security.mixed_content.block_display_content", true);
lockPref("security.mixed_content.block_object_subrequest", true);
lockPref("dom.security.https_only_mode", true);
lockPref("security.ssl.treat_unsafe_negotiation_as_broken", true);
lockPref("browser.xul.error_pages.expert_bad_cert", true);
lockPref("security.insecure_connection_icon.enabled", true);
lockPref("security.insecure_connection_text.enabled", true);

// TLS hardening that can be fingerprinted
lockPref("security.tls.version.min", 3);
lockPref("security.ssl3.rsa_des_ede3_sha", false);
lockPref("security.ssl3.ecdhe_ecdsa_aes_128_sha", false);
lockPref("security.ssl3.ecdhe_rsa_aes_128_sha", false);
lockPref("security.ssl3.dhe_rsa_aes_128_sha", false);
lockPref("security.ssl3.dhe_rsa_aes_256_sha", false);
lockPref("security.ssl3.rsa_aes_128_sha", false);
lockPref("security.ssl3.rsa_aes_256_sha", false);
