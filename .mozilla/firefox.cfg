// This borrows a LOT from ghacks-user.js
// https://github.com/ghacksuserjs/ghacks-user.js/blob/master/user.js

// Get rid of some annoyances
defaultPref("media.navigator.enabled", false);
lockPref("browser.shell.checkDefaultBrowser", false);
defaultPref("browser.fixup.alternate.enabled", false);
defaultPref("browser.urlbar.trimURLs", false);
defaultPref("browser.urlbar.usepreloadedtopurls.enabled", false);
defaultPref("browser.sessionstore.interval", 60000);
defaultPref("media.autoplay.default", 5);
defaultPref("browser.link.open_newwindow", 3);
defaultPref("browser.link.open_newwindow.restriction", 0);
defaultPref("dom.disable_open_during_load", true);
defaultPref("dom.popup_allowed_events", "click dblclick");
defaultPref("dom.serviceWorkers.enabled", false);
defaultPref("permissions.default.desktop-notification", 2);
defaultPref("dom.disable_beforeunload", true);
defaultPref("browser.helperApps.deleteTempFileOnExit", true);
defaultPref("browser.pagethumbnails.capturing_disabled", true);
defaultPref("middlemouse.contentLoadURL", false);
defaultPref("permissions.default.shortcuts", 2);
defaultPref("network.IDN_show_punycode", true);
defaultPref("pdfjs.disabled", false);
defaultPref("browser.download.useDownloadDir", true);
defaultPref("browser.startup.homepage_override.mstone", "ignore");
defaultPref("browser.tabs.warnOnClose", false);
defaultPref("browser.tabs.warnOnCloseOtherTabs", false);
defaultPref("browser.tabs.warnOnOpen", false);
defaultPref("full-screen-api.warning.delay", 0);
defaultPref("full-screen-api.warning.timeout", 0);
defaultPref("browser.download.autohideButton", true);
defaultPref("toolkit.cosmeticAnimations.enabled", false);
defaultPref("ui.key.menuAccessKey", 0);
defaultPref("browser.messaging-system.whatsNewPanel.enabled", false);
defaultPref("browser.newtabpage.activity-stream.feeds.topsites", false);
defaultPref("browser.newtabpage.activity-stream.feeds.section.highlights", false);

// Disable telemetry
lockPref("geo.enabled", false);
lockPref("geo.provider.use_gpsd", false);
lockPref("browser.newtabpage.activity-stream.feeds.telemetry", false);
lockPref("browser.newtabpage.activity-stream.telemetry", false);
lockPref("browser.newtabpage.activity-stream.feeds.snippets", false);
lockPref("browser.newtabpage.activity-stream.asrouter.providers.snippets", "");
lockPref("browser.newtabpage.activity-stream.feeds.section.topstories", false);
lockPref("browser.newtabpage.activity-stream.section.highlights.includePocket", false);
lockPref("browser.newtabpage.activity-stream.showSponsored", false);
lockPref("browser.newtabpage.activity-stream.feeds.discoverystreamfeed", false);
lockPref("dom.ipc.plugins.flash.subprocess.crashreporter.enabled", false);
lockPref("dom.ipc.plugins.reportCrashURL", false);
lockPref("extensions.getAddons.showPane", false);
lockPref("extensions.htmlaboutaddons.recommendations.enabled", false);
lockPref("toolkit.telemetry.unified", false);
lockPref("toolkit.telemetry.enabled", false);
lockPref("toolkit.telemetry.server", "data:,");
lockPref("toolkit.telemetry.archive.enabled", false);
lockPref("toolkit.telemetry.newProfilePing.enabled", false);
lockPref("toolkit.telemetry.shutdownPingSender.enabled", false);
lockPref("toolkit.telemetry.updatePing.enabled", false);
lockPref("toolkit.telemetry.bhrPing.enabled", false);
lockPref("toolkit.telemetry.firstShutdownPing.enabled", false);
lockPref("toolkit.telemetry.coverage.opt-out", true);
lockPref("toolkit.coverage.opt-out", true);
lockPref("toolkit.coverage.endpoint.base", "");
lockPref("datareporting.healthreport.uploadEnabled", false);
lockPref("datareporting.policy.dataSubmissionEnabled", false);
lockPref("app.shield.optoutstudies.enabled", false);
lockPref("browser.discovery.enabled", false);
lockPref("breakpad.reportURL", "");
lockPref("browser.tabs.crashReporting.sendReport", false);
lockPref("browser.crashReports.unsubmittedCheck.enabled", false);
lockPref("browser.crashReports.unsubmittedCheck.autoSubmit2", false);
lockPref("captivedetect.canonicalURL", "");
lockPref("network.captive-portal-service.enabled", false);
lockPref("network.connectivity-service.enabled", false);
lockPref("extensions.blocklist.url", "https://blocklists.settings.services.mozilla.com/v1/blocklist/3/%APP_ID%/%APP_VERSION%/");
lockPref("browser.safebrowsing.malware.enabled", false);
lockPref("browser.safebrowsing.phishing.enabled", false);
lockPref("browser.safebrowsing.downloads.enabled", false);
lockPref("app.normandy.enabled", false);
lockPref("app.normandy.api_url", "");
lockPref("extensions.systemAddon.update.enabled", false);
lockPref("extensions.systemAddon.update.url", "");
lockPref("browser.ping-centre.telemetry", false);
lockPref("extensions.screenshots.upload-disabled", true);
lockPref("extensions.webcompat-reporter.enabled", false);
lockPref("security.ssl.errorReporting.automatic", false);
lockPref("security.ssl.errorReporting.enabled", false);
lockPref("security.ssl.errorReporting.url", "");
lockPref("extensions.pocket.enabled", false);
lockPref("identity.fxaccounts.enabled", false);
lockPref("browser.newtabpage.activity-stream.asrouter.userprefs.cfr.addons", false);
lockPref("browser.newtabpage.activity-stream.asrouter.userprefs.cfr.features", false);
lockPref("network.manage-offline-status", false);

// Various privacy improvements
defaultPref("network.prefetch-next", false);
defaultPref("network.dns.disablePrefetch", true);
defaultPref("network.dns.disablePrefetchFromHTTPS", true);
defaultPref("network.predictor.enabled", false);
defaultPref("network.predictor.enable-prefetch", false);
defaultPref("network.http.speculative-parallel-limit", 0);
defaultPref("browser.send_pings", false);
defaultPref("browser.send_pings.require_same_host", true);
defaultPref("layout.css.visited_links_enabled", false);
defaultPref("browser.urlbar.speculativeConnect.enabled", false);
defaultPref("signon.autofillForms", false);
defaultPref("signon.rememberSignons", false);
defaultPref("gfx.font_rendering.graphite.enabled", false);
defaultPref("network.http.sendRefererHeader", 0);
defaultPref("privacy.donottrackheader.enabled", true);
defaultPref("plugin.state.flash", 0);
defaultPref("media.gmp-provider.enabled", false);
defaultPref("media.gmp-widevinecdm.visible", false);
defaultPref("media.gmp-widevinecdm.enabled", false);
defaultPref("media.eme.enabled", false);
defaultPref("media.peerconnection.enabled", false);
defaultPref("webgl.disabled", true);
defaultPref("webgl.enable-webgl2", false);
defaultPref("media.getusermedia.screensharing.enabled", false);
defaultPref("media.getusermedia.browser.enabled", false);
defaultPref("media.getusermedia.audiocapture.enabled", false);
defaultPref("permissions.default.camera", 2);
defaultPref("permissions.default.microphone", 2);
defaultPref("javascript.options.asmjs", false);
//defaultPref("javascript.options.ion", false);
//defaultPref("javascript.options.baselinejit", false);
//defaultPref("javascript.options.jit_trustedprincipals", true);
defaultPref("javascript.options.wasm", false);
defaultPref("dom.battery.enabled", false);
defaultPref("media.navigator.enabled", false);
defaultPref("dom.webaudio.enabled", false);
defaultPref("dom.vr.enabled", false);
defaultPref("accessibility.force_disabled", 1)
defaultPref("beacon.enabled", false);
defaultPref("devtools.debugger.remote-enabled", false);
defaultPref("permissions.manager.defaultsUrl", "");
defaultPref("webchannel.allowObject.urlWhitelist", "");
defaultPref("browser.display.use_system_colors", false);
lockPref("browser.contentblocking.category", "custom");
defaultPref("network.cookie.cookieBehavior", 3);
defaultPref("privacy.firstparty.isolate", true);
defaultPref("privacy.firstparty.isolate.restrict_opener_access", true); // Reduce some site breakage
defaultPref("privacy.resistFingerprinting", true);
//defaultPref("privacy.resistFingerprinting.letterboxing", true);
defaultPref("media.navigator.enabled", false);
defaultPref("dom.event.clipboardevents.enabled", false);
defaultPref("extensions.formautofill.addresses.enabled", false);
defaultPref("extensions.formautofill.available", "off");
defaultPref("extensions.formautofill.creditCards.enabled", false);
defaultPref("extensions.formautofill.heuristics.enabled", false);

// TLS hardening
defaultPref("security.ssl.require_safe_negotiation", true);
defaultPref("security.tls.version.min", 3);
defaultPref("security.ssl.disable_session_identifiers", true);
defaultPref("security.tls.enable_0rtt_data", false);
defaultPref("security.ssl.enable_ocsp_stapling", true);
defaultPref("security.OCSP.enabled", 1);
defaultPref("security.OCSP.require", true);
defaultPref("security.pki.sha1_enforcement_level", 1);
defaultPref("security.cert_pinning.enforcement_level", 2);
defaultPref("security.mixed_content.block_active_content", true);
defaultPref("security.mixed_content.block_display_content", true);
defaultPref("security.mixed_content.block_object_subrequest", true);
defaultPref("security.ssl3.rsa_des_ede3_sha", false);
defaultPref("security.ssl3.ecdhe_ecdsa_aes_128_sha", false);
defaultPref("security.ssl3.ecdhe_rsa_aes_128_sha", false);
defaultPref("security.ssl3.dhe_rsa_aes_128_sha", false);
defaultPref("security.ssl3.dhe_rsa_aes_256_sha", false);
defaultPref("security.ssl3.rsa_aes_128_sha", false);
defaultPref("security.ssl3.rsa_aes_256_sha", false);
defaultPref("security.insecure_connection_icon.enabled", true);
defaultPref("security.insecure_connection_text.enabled", true);

